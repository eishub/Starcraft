init module{
	knowledge{
		rallyLocation(X,Y, RX,RY) 
			:-	findall([D,BX,BY], (chokepoint(BX,BY), distance(X,Y,BX,BY,D)), L),
				sort(L, [[_,RX,RY]|_]). 				
		distance(X1,Y1,X2,Y2,D) :- D is sqrt((X2-X1)**2 + (Y2-Y1)**2).	
		
		buildLocation(X, Y) :- 
				percept(friendly(_, "Terran Command Center", _,_ ,_ , _, _ , TX, TY)),
				buildingLocation(TX, TY, X, Y).
				
		buildingLocation(X,Y, RX,RY) 
			:-	findall([D,BX,BY], (percept(constructionSite(BX,BY)), distance(X,Y,BX,BY,D)), L),
				sort(L, [[_,RX,RY]|_]). 		
	}
	
	program{
		if bel(percept(friendly(_,"Terran Command Center",_,_,_,_,_,X,Y))) then insert(commandCenter(X,Y)).
		forall bel(percept(chokepoint(X,Y))) do insert(chokepoint(X,Y)).
	}	
}

main module{
	beliefs{
		
	}
	program{	
		if bel(percept(isBeingConstructed)) then skip.
		if bel(percept(rallyPoint(RX,RY)), RX = 0, RY = 0, commandCenter(X,Y), rallyLocation(X,Y,NX,NY)) then setRallyPoint(NX,NY).	
		if bel(not(percept(addon("Terran Machine Shop"))),percept(queueSize(N)), N = 0, percept(minerals(X)), X>=50, percept(gas(Y)), Y>=50) 
			then buildAddon("Terran Machine Shop").
		
		%if bel(percept(position(X, Y)), percept(friendly(_,_,_,_,_,_,_,BX,BY)), distance(X, Y, BX, BY, D), D > 2, 
		%not(percept(lifted)), not(percept(addon("Terran Machine Shop")))) then lift.
		
		%if bel(percept(lifted), percept(friendly(_,"Terran Command Center",_,_,_,_,_,X,Y)), BY is Y - 5) then land(X, BY).
		if bel(trainTank) then train("Terran Siege Tank Tank Mode") + delete(trainTank).
	}
	actionspec {
		move(X, Y){
			pre{true}
			post{true}
		}
		
		lift{
			pre{true}
			post{true}	
		}
		
		land(X, Y){
			pre{true}
			post{true}	
		}
			
		train(Id) {
			pre {true}
			post {true}
		}
		
		buildAddon(X) {
			pre {true}
			post {true}
		}
		
		setRallyPoint(X,Y){
			pre {true}
			post {true}
		}
		
		skip {
			pre {true}
			post {true}	
		}
	}
}

event module {
	program {
		
		if bel(percept(queueSize(N)), N < 1, percept(supply(Y,Z)), percept(minerals(X)), X>=150, percept(gas(G)), G>= 100 , (Z - Y) >= 4 ) then{
			 if bel(percept(addon("Terran Machine Shop"))) then insert(trainTank).
		}
	}	
}
